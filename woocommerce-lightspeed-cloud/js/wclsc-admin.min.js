var wclsc_update_sync,wclsc_update_status;jQuery(function(t){function c(t,c,e,s){var n=void 0!=window.screenLeft?window.screenLeft:screen.left,a=void 0!=window.screenTop?window.screenTop:screen.top;width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var r=width/2-e/2+n,o=height/2-s/2+a,l=window.open(t,c,"scrollbars=yes, chrome=yes, menubar=no, toolbar=no, width="+e+", height="+s+", top="+o+", left="+r);window.focus&&l.focus()}function e(c,e){var e=e?e:"error",s=t("div.wclsc-"+e),n=t("<p />").html(c);if(!s.length){var s=t("<div />").addClass(e).addClass("wclsc-"+e).hide();t(".wrap h2").after(s)}s.is(":visible")||s.hide(),s.html(n).fadeIn("fast")}function s(c){var c=c?c:"error",e=t("div.wclsc-"+c);e.fadeOut("fast",function(){e.remove()})}function n(c){!function e(){c.hasClass("syncing")&&setTimeout(function(){t.ajax({data:{action:"wclsc_trigger_cron"},dataType:"json",url:wclsc_vars.ajax_url+"?wclsc=trigger-cron",success:function(t){t&&t.cron&&console.log(t.cron)}}),t.ajax({data:{action:"wclsc_get_sync_status"},dataType:"json",url:wclsc_vars.ajax_url+"?wclsc=sync-status",type:"post",success:function(t){t&&t.html&&c.html(t.html),(!t.html||"undefined"!=typeof t.complete&&"1"==t.complete)&&c.removeClass("syncing")},complete:e})},5e3)}()}var a=t("<input />").attr("type","button").addClass("wclsc-lookup-account-id").addClass("button").attr("value",wclsc_vars.lookup_account_text);a.on("click",function(c){c.preventDefault();var n=t("input#"+wclsc_vars.opt_prefix+"api_key").val();if(!n)return e(wclsc_vars.api_key_error,"error"),!1;s("error");var a=t("<span />").addClass("spinner").addClass("wclsc-spinner");return t(this).after(a),t.ajax({url:wclsc_vars.ajax_url+"?wclsc=lookup-account-id",type:"post",dataType:"json",data:{action:"wclsc_lookup_account_id",api_key:n},success:function(c){a.remove(),c.success?(t("input#"+wclsc_vars.opt_prefix+"account_id").val(c.account_id),e(wclsc_vars.account_success_text,"updated")):e(c.error_message,"error")}}),!1}),t("input#"+wclsc_vars.opt_prefix+"account_id").after(a),t("input.wclsc-clear-log").on("click",function(c){return c.preventDefault(),confirm(wclsc_vars.confirm_clear_log)?void t.ajax({url:wclsc_vars.ajax_url+"?wclsc=clear-error-log",type:"post",dataType:"json",data:{action:"wclsc_clear_error_log"},success:function(c){c.success?(t("textarea."+wclsc_vars.opt_prefix+"error_log").replaceWith(t("<p />").html(wclsc_vars.no_errors_message)),e(wclsc_vars.logs_clear_text,"updated")):e(c.error_message,"error")}}):!1});var r=t(".lightspeed-order-details");if(r.length&&(r.appendTo("#order_data"),t('a[href^="#lightspeed-order-details"]').on("click",function(){var c=t(".lightspeed-order-details");return t(this).text(c.is(":visible")?t(this).text().replace("Hide","Show"):t(this).text().replace("Show","Hide")),c.slideToggle("fast"),!1}),t('a[href^="#lightspeed-sale-object"]').on("click",function(){var c=t(".lightspeed-sale-object");return t(this).text(c.is(":visible")?t(this).text().replace("Hide","Show"):t(this).text().replace("Show","Hide")),c.slideToggle("fast"),!1})),t("#wclsc_oauth").on("click",function(e){e.preventDefault();var s=t(this).attr("href"),n=t(this).data("width")?t(this).data("width"):600,a=t(this).data("height")?t(this).data("height"):600;return c(s,"wclsc_oauth",n,a),t(this).hide(),t("#wclsc_oauth_code").show(),!1}),t("#ls-product-sync").length){var o=t('input[type="hidden"]#post_ID').val();o&&(t("#ls-product-sync").html('<div class="spinner" style="display:block;"></div>'),t.ajax({data:{action:"wclsc_single_product_sync",product_id:o},dataType:"json",url:wclsc_vars.ajax_url+"?wclsc=single-product-sync",type:"post",success:function(c){t("#ls-product-sync").css("padding-bottom","13px").html(c.html),t(".wclsc-sync-product").on("click",function(c){c.preventDefault();var e=t(this),s=e.data("item-id");return s?confirm("Syncing this item will overwrite any changes made in WooCommerce and will import data from LightSpeed. Are you sure you want to continue?")?(e.html("Syncing..."),void t.ajax({data:{action:"wclsc_force_sync_product",item_id:s},dataType:"json",url:wclsc_vars.ajax_url+"?wclsc=force-single-product-sync",type:"post",success:function(t){t&&t.success?(e.html("Synced! Redirecting..."),t.redirect?window.location.replace(t.redirect):location.reload()):e.html("Sync Failed.")}})):!1:(alert("Error: LightSpeed Item ID not found."),t(this).remove(),!1)})}}))}t(".wclsc-stop-sync").live("click",function(c){c.preventDefault();var e=t(this).parents(".wclsc-sync");return e.removeClass("syncing"),t.ajax({data:{action:"wclsc_abort_product_sync"},dataType:"json",url:wclsc_vars.ajax_url+"?wclsc=abort-product-sync",type:"post",success:function(t){t.html&&e.html(t.html)}}),!1});var l=t(".wclsc-sync.syncing");l.length&&n(l),t(".wclsc-start-sync").on("click",function(c){c.preventDefault();var e=t(this).parents(".wclsc-sync");e.addClass("syncing").html('<div class="sync-status">Sync Starting...</div>'),t.ajax({data:{action:"wclsc_all_product_sync"},dataType:"json",url:wclsc_vars.ajax_url+"?wclsc=all-product-sync",type:"post",success:function(t){t&&t.html&&e.html(t.html),n(e)}})}),t(".wclsc-start-inventory-sync").on("click",function(c){c.preventDefault();var e=t(this);e.html("Syncing Inventory..."),t.ajax({data:{action:"wclsc_product_inventory_sync"},dataType:"json",url:wclsc_vars.ajax_url+"?wclsc=product-inventory-sync",type:"post",success:function(t){t&&t.html&&$parent.html(t.html),e.html("Inventory Sync Started.")}})})});
